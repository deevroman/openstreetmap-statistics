<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=800">
    <meta name="description" content="Monthly updated interactive statistics of OpenStreetMap.">
    <title>OpenStreetMap Statistics</title>
    <link rel='icon' type='image/x-icon' href='/assets/favicon.ico' />
    <link rel="stylesheet" type="text/css" href="/assets/statistic_website.css">
    <!-- <script src="assets/statistic_website.js"></script> -->
    <script src="/assets/plotly-custom.min.js"></script>
    <!-- <script defer data-domain="piebro.github.io/openstreetmap-statistics" src="https://plausible.io/js/script.js"></script> -->
</head>

<script>
var data_cache = {};

async function load_data(data_name) {
    if (!(data_name in data_cache)) {
        data_cache[data_name] = await fetch("/assets/data/" + data_name + ".json").then((response) => {
            return response.json();
        });
    }
    return data_cache[data_name];
}

async function show_plot(plot_config){
    data = await load_data(plot_config["filename"])
    // traces = []
    // for (trace of plot_config["traces"]){
    //     // const x = data["data"].map((tuple) => tuple[data["columns"].indexOf(trace["x"])]);
    //     // const y = data["data"].map((tuple) => tuple[data["columns"].indexOf(trace["y"])]);
    //     const type = "asd"
    //     traces.push({
    //         ...trace,
    //         // x: x,
    //         // y: y,
    //     })
    // }

    div = document.getElementById(plot_config["filename"])
    Plotly.newPlot(
        div,
        plot_config["traces"],
        plot_config["layout"],
        {displayModeBar: false, staticPlot: screen.width < 850}
    );
}

async function update_plots(){
    const plot_configs = await load_data("plot_configs")
    for (const [_, plot_config] of Object.entries(plot_configs)) {
        show_plot(plot_config);
    }
}

async function init(){
    update_plots()

    window.addEventListener(
        "resize",
        function (event) {
            update_plots()
        },
        true,
    );
}
</script>

<body onload="init()">
    <h2>OpenStreetMap Statistics</h2>
    Here is some text.
    <br>
    <div id="general_contributor_count_monthly" class="dataDiv", style="display: inline-block;"></div>
    <br>
    <div id="general_new_contributor_count_monthly" class="dataDiv", style="display: inline-block;"></div>
    <br>
    <div id="general_no_maps_me_contributor_count_monthly" class="dataDiv", style="display: inline-block;"></div>
    <br>
    
    Here is some more text.
    <br>
    <br>
    <div>
        <button id="save_plot_btn">save plot(s)</button>
        <button id="save_data_btn">save data</button>
    </div>
</body>

</html>